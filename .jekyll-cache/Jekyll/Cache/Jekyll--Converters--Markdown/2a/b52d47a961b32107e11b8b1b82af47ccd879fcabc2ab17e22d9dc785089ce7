I"}m<p>In this post I’ll outline the steps I took including setting up Synapse and what configuration I used. My install used simple username and password authentication and a 3rd party SMTP provider. I did not <a href="https://matrix-org.github.io/synapse/latest/turn-howto.html">set up a TURN server</a> during my experience so that will not be included.</p>

<p>As Docker Compose is an extension of Docker syntax, all the steps involving it <em>can</em> be done without it however that will be an exercise left to the reader.</p>

<div style="position: relative;">
	<a href="#toc-skipped" class="screen-reader-only">Skip table of contents</a>
</div>
<ul id="markdown-toc">
  <li><a href="#prerequisites" id="markdown-toc-prerequisites">Prerequisites</a>    <ul>
      <li><a href="#knowledge" id="markdown-toc-knowledge">Knowledge</a></li>
      <li><a href="#resources" id="markdown-toc-resources">Resources</a></li>
    </ul>
  </li>
  <li><a href="#definitions" id="markdown-toc-definitions">Definitions</a></li>
  <li><a href="#instructions" id="markdown-toc-instructions">Instructions</a>    <ul>
      <li><a href="#domain-preparation" id="markdown-toc-domain-preparation">Domain Preparation</a></li>
      <li><a href="#generating-a-configuration-file" id="markdown-toc-generating-a-configuration-file">Generating a Configuration File</a></li>
      <li><a href="#editing-homeserveryaml" id="markdown-toc-editing-homeserveryaml">Editing ‘homeserver.yaml’</a></li>
      <li><a href="#adding-postgres-to-docker-composeyml" id="markdown-toc-adding-postgres-to-docker-composeyml">Adding Postgres to docker-compose.yml</a></li>
      <li><a href="#create-your-first-user" id="markdown-toc-create-your-first-user">Create your first user</a></li>
      <li><a href="#traefik-configuration" id="markdown-toc-traefik-configuration">Traefik configuration</a></li>
    </ul>
  </li>
  <li><a href="#conclusion" id="markdown-toc-conclusion">Conclusion</a></li>
  <li><a href="#further-reading" id="markdown-toc-further-reading">Further Reading</a></li>
</ul>
<div id="toc-skipped"></div>

<h2 id="prerequisites">Prerequisites</h2>

<p>If <em>(for some reason)</em> you are using this as a guide for doing this yourself, you will need the following:</p>

<h3 id="knowledge">Knowledge</h3>
<ul>
  <li><em>basic</em> Ubuntu Server and Linux</li>
  <li><em>basic</em> Docker, Docker Compose</li>
  <li><em>basic</em> Traefik Proxy</li>
</ul>

<h3 id="resources">Resources</h3>
<ul>
  <li>Internet-Accessible Server
    <ul>
      <li>Ubuntu 20.04 <em>or newer</em></li>
      <li>4GB of RAM <em>minimum</em></li>
      <li>8GB of Storage <em>minimum</em></li>
      <li>Terminal access</li>
    </ul>
  </li>
  <li>Domain Name
    <ul>
      <li>Use of ports <code class="language-plaintext highlighter-rouge">443</code> and <code class="language-plaintext highlighter-rouge">8448</code><sup>†<sup></sup></sup></li>
    </ul>
  </li>
  <li>Required Tools
    <ul>
      <li><a href="https://www.digitalocean.com/community/tutorials/how-to-install-and-use-docker-on-ubuntu-20-04">Docker</a></li>
      <li><a href="https://www.digitalocean.com/community/tutorials/how-to-install-and-use-docker-compose-on-ubuntu-20-04">Docker Compose</a></li>
      <li><a href="https://doc.traefik.io/traefik/getting-started/quick-start/#launch-traefik-with-the-docker-provider">Traefik</a> with Docker Provider</li>
    </ul>
  </li>
  <li>Caffeine Delivery System <em>(optional)</em></li>
</ul>

<p><sup><sup>†</sup>Alternatives described in <a href="#domain-set-up">Domain Set-up</a> <br />
<em>Need a server? Get $100 in credit for 2 months through my <a href="https://m.do.co/c/2d2f25b376ae">DigitalOcean Referral Code</a>!</em> <br />
<em>Need a domain? Get $5 off your first one through my <a href="https://www.name.com/referral/302312">Name.com Referral Code</a>!</em></sup> <br />
Assuming you have everything above squared away you can continue!</p>

<h2 id="definitions">Definitions</h2>

<h3 class="no_toc" id="matrix">Matrix</h3>
<p><a href="https://en.wikipedia.org/wiki/Matrix_(protocol)">Matrix</a> is a Real-Time Communication Protocol and Open Standard that relies on the federation of “homeservers” to build a communication network.</p>

<h3 class="no_toc" id="matrixorg">Matrix.org</h3>
<p><a href="https://matrix.org/foundation/">Matrix.org</a> is the non-profit foundation behind the Matrix protocol. They also develop and distribute Synapse.</p>

<h3 class="no_toc" id="element">Element</h3>
<p><a href="https://en.wikipedia.org/wiki/Element_(software)">Element</a> is both a Matrix Client and the name of the company behind said Client</p>

<h3 class="no_toc" id="synapse">Synapse</h3>
<p><a href="https://matrix.org/docs/projects/server/synapse">Synapse</a> is the most popular homeserver implementation. Created by the Matrix.org team and the subject of this blog post.</p>

<h3 class="no_toc" id="homeserver">Homeserver</h3>
<p>A homeserver is the term used by Matrix to specify that it’s a Matrix server and not a web server, a virtual private server, a minecraft server, etc. It is the “home” of the users registered at your server and where the messages from the channels of other homeservers they have joined will be collected.</p>

<h3 class="no_toc" id="federation">Federation</h3>
<p>Federation is the inter-connectivity of independent and distinct systems using a formalized protocol. Anyone can set-up their own Matrix homeserver and connect it to a federated Matrix network.</p>

<h2 id="instructions">Instructions</h2>

<h3 id="domain-preparation">Domain Preparation</h3>
<p>As one of the first steps of setting up Synapse involves informing it of the domain being used, it makes sense to talk about it first.</p>

<p>With Matrix, the domain, aka “server name”, is used as an identifier for the homesever and local users when interacting with other servers and users. Changing the domain will be treated as making a completely new homeserver. There is <a href="https://github.com/matrix-org/matrix-doc/blob/neilalexander/identities/proposals/2787-portable-identities.md">a proposal</a> for Portable Identities which might help with server migration but as of now it’s still in drafts, so choose carefully now to avoid potential headaches.</p>

<p>A homeserver’s server name plays a key factor in the identifier for the users and rooms created on it, providing a namespace to reduce collisions between names on ever growing networks. It also can function as quick way to distinguish your association, e.g. <code class="language-plaintext highlighter-rouge">@jake:statefarm.com</code>, <code class="language-plaintext highlighter-rouge">@bear:big.blue.house</code>, or <code class="language-plaintext highlighter-rouge">@geralt:riv.ia</code>. Given that, it’s recommended that you have your homeserver use a clean version of your domain; <code class="language-plaintext highlighter-rouge">@neo:zion.city</code> would be a better choice than <code class="language-plaintext highlighter-rouge">@neo:chat.zion.city</code>, for example.</p>

<p>With all that out of the way, let’s begin planning.</p>

<p>Both Clients and other Homeservers will attempt to connect with yours using HTTPS, however they both default to using different ports. Client-Server communication defaults to standard <code class="language-plaintext highlighter-rouge">443</code> of HTTPS while Server-Server communication uses <code class="language-plaintext highlighter-rouge">8448</code>. Synapse, of course, listens for both clients and other servers over HTTP on port <code class="language-plaintext highlighter-rouge">8008</code>; that is where using a reverse proxy, in our case traefik, comes in, which we will configure later.</p>

<p>If assigning port <code class="language-plaintext highlighter-rouge">443</code> (or <code class="language-plaintext highlighter-rouge">8448</code>) on your domain is an issue, there are alternative methods avaliable to let you keep it as your server name. These include configuring your reverse proxy to forward only <a href="https://matrix-org.github.io/synapse/latest/reverse_proxy.html">specific paths/locations to Matrix</a> or add forwarding info to another domain, either via <a href="https://matrix-org.github.io/synapse/latest/delegate.html#well-known-delegation">serving a JSON file</a> or <a href="https://matrix-org.github.io/synapse/latest/delegate.html#srv-dns-record-delegation">using a SRV record</a>. Neither will be covered in this post directly.</p>

<p>Assuming you don’t have those issues, the only real step here is to make sure your domain is correctly pointed towards your server!</p>

<h3 id="generating-a-configuration-file">Generating a Configuration File</h3>

<p>In the working directory of your choice, create the following as <code class="language-plaintext highlighter-rouge">docker-compose.yml</code></p>

<div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">version</span><span class="pi">:</span> <span class="s2">"</span><span class="s">3.7"</span>

<span class="na">services</span><span class="pi">:</span>
  <span class="na">synapse</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s2">"</span><span class="s">matrixdotorg/synapse:latest"</span>
    <span class="na">container_name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">yournamingscheme-synapse"</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="na">SYNAPSE_SERVER_NAME</span><span class="pi">:</span> <span class="s2">"</span><span class="s">example.org"</span>
      <span class="na">SYNAPSE_REPORT_STATS</span><span class="pi">:</span> <span class="s2">"</span><span class="s">yes"</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">type</span><span class="pi">:</span> <span class="s2">"</span><span class="s">bind"</span>
        <span class="na">source</span><span class="pi">:</span> <span class="s2">"</span><span class="s">${PWD}/synapse"</span>
        <span class="na">target</span><span class="pi">:</span> <span class="s2">"</span><span class="s">/data"</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s2">"</span><span class="s">unless-stopped"</span>
    <span class="na">ulimits</span><span class="pi">:</span>
      <span class="na">nofile</span><span class="pi">:</span>
        <span class="na">soft</span><span class="pi">:</span> <span class="m">131072</span>
        <span class="na">hard</span><span class="pi">:</span> <span class="m">131072</span>
</code></pre></div></div>
<p>In your instance:</p>
<ul>
  <li>replace <code class="language-plaintext highlighter-rouge">yournamingscheme-synapse</code> with a naming scheme of your choice.</li>
  <li>replace <code class="language-plaintext highlighter-rouge">example.org</code> with your server name of choice</li>
  <li>optionally, change <code class="language-plaintext highlighter-rouge">SYNAPSE_REPORT_STATS</code> to <code class="language-plaintext highlighter-rouge">"no"</code> if you don’t want to share information with Matrix.org</li>
  <li>optionally, change the <code class="language-plaintext highlighter-rouge">source</code> of the volume to a different location.</li>
</ul>

<p>The <code class="language-plaintext highlighter-rouge">ulimits</code> setting extends the number of file handlers used within the container, the default amount can cause issues for the server</p>

<p>then create a <code class="language-plaintext highlighter-rouge">synapse</code> directory in your working directory</p>

<p>once ready run <code class="language-plaintext highlighter-rouge">docker-compose run synapse generate</code> and you should get output like this:</p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>julian@server:/docker/yournamingscheme/synapse<span class="nv">$ </span>docker-compose run synapse generate
Creating log config /data/example.org.log.config
Generating config file /data/homeserver.yaml
Generating signing key file /data/example.org.signing.key
A config file has been generated <span class="k">in</span> <span class="s1">'/data/homeserver.yaml'</span> <span class="k">for </span>server name <span class="s1">'example.org'</span><span class="nb">.</span> Please review this file and customise it to your needs.
</code></pre></div></div>
<p>It may seem unresponsive for a short while during the generation but it should complete in a reasonable timeframe.</p>

<h3 id="editing-homeserveryaml">Editing ‘homeserver.yaml’</h3>

<p>Using nano, or your text editor of choice, open the homeserver.yaml: <code class="language-plaintext highlighter-rouge">sudo nano ./synapse/homeserver.yaml</code>. <br />
There are a lot of configuration options, most with quick summaries commented above them. For now though we will focus on a select few, though I do recommend always reading the documentation.</p>

<h4 class="no_toc" id="-server-">## Server ##</h4>
<p>From the top down you should see <code class="language-plaintext highlighter-rouge">server_name</code>, this should already be filled with the value you passed into the container via <code class="language-plaintext highlighter-rouge">SYNAPSE_SERVER_NAME</code>.</p>

<p>Next is the listener section, the only change to make is to remove <code class="language-plaintext highlighter-rouge">bind_addresses: ['::1', '127.0.0.1']</code> from the configuration for port 8008. Synapse will be using HTTP since Traefik will be unwrapping the HTTPS for it.</p>

<h4 class="no_toc" id="-database-">## Database ##</h4>
<p>By default Synapse generates and uses a SQite3 database, however we will be switching it to Postgres so it can handle an average load.</p>

<p>Replace the contents of the database section with the following:</p>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">database</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">psycopg2</span>
  <span class="na">args</span><span class="pi">:</span>
    <span class="na">user</span><span class="pi">:</span> <span class="s">synapse</span>
    <span class="na">password</span><span class="pi">:</span> <span class="s">strongGeneratedPasswordHere</span>
    <span class="na">host</span><span class="pi">:</span> <span class="s">yournamingscheme-postgres</span>
    <span class="na">cp_min</span><span class="pi">:</span> <span class="m">5</span>
    <span class="na">cp_max</span><span class="pi">:</span> <span class="m">10</span>
</code></pre></div></div>
<p>Remember the configuration added here as it will be reused in the <code class="language-plaintext highlighter-rouge">docker-compose.yml</code> when adding the database</p>

<h4 class="no_toc" id="-registration-">## Registration ##</h4>
<p>Assuming you want users to be able to join your home server, you should enable registeration with <code class="language-plaintext highlighter-rouge">enable_registration: true</code>. In this section you can also configure what the user needs when registering, e.g., email, phone number, password requirements. Synapse and Matrix are very requirement agnostic, letting homeserver owners tune it to their specifications.</p>

<p>Do note that for items like email and single-sign on, further configuration will be needed in lower sections.</p>

<h3 id="adding-postgres-to-docker-composeyml">Adding Postgres to docker-compose.yml</h3>

<p>Update your <code class="language-plaintext highlighter-rouge">docker-compose.yml</code> with configuration for postgres:</p>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">version</span><span class="pi">:</span> <span class="s2">"</span><span class="s">3.7"</span>

<span class="na">services</span><span class="pi">:</span>
  <span class="na">synapse</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s2">"</span><span class="s">matrixdotorg/synapse:latest"</span>
    <span class="na">container_name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">yournamingscheme-synapse"</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="na">SYNAPSE_SERVER_NAME</span><span class="pi">:</span> <span class="s2">"</span><span class="s">example.org"</span>
      <span class="na">SYNAPSE_REPORT_STATS</span><span class="pi">:</span> <span class="s2">"</span><span class="s">yes"</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">type</span><span class="pi">:</span> <span class="s2">"</span><span class="s">bind"</span>
        <span class="na">source</span><span class="pi">:</span> <span class="s2">"</span><span class="s">${PWD}/synapse"</span>
        <span class="na">target</span><span class="pi">:</span> <span class="s2">"</span><span class="s">/data"</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s2">"</span><span class="s">unless-stopped"</span>
    <span class="na">ulimits</span><span class="pi">:</span>
      <span class="na">nofile</span><span class="pi">:</span>
        <span class="na">soft</span><span class="pi">:</span> <span class="m">131072</span>
        <span class="na">hard</span><span class="pi">:</span> <span class="m">131072</span>
    <span class="na">depends_on</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">postgres"</span>
  <span class="na">postgres</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s2">"</span><span class="s">postgres:14"</span>
    <span class="na">container_name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">yournamingscheme-postgres"</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="na">POSTGRES_USER</span><span class="pi">:</span> <span class="s2">"</span><span class="s">synapse"</span>
      <span class="na">POSTGRES_PASSWORD</span><span class="pi">:</span> <span class="s2">"</span><span class="s">useThePasswordYouPutInHomeserverYAML"</span>
      <span class="na">POSTGRES_INITDB_ARGS</span><span class="pi">:</span> <span class="s2">"</span><span class="s">--encoding=UTF8</span><span class="nv"> </span><span class="s">--locale=C"</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">type</span><span class="pi">:</span> <span class="s2">"</span><span class="s">bind"</span>
        <span class="na">source</span><span class="pi">:</span> <span class="s2">"</span><span class="s">${PWD}/postgres"</span>
        <span class="na">target</span><span class="pi">:</span> <span class="s2">"</span><span class="s">/var/lib/postgresql/data"</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s2">"</span><span class="s">unless-stopped"</span>
</code></pre></div></div>
<p><code class="language-plaintext highlighter-rouge">container_name</code> and <code class="language-plaintext highlighter-rouge">POSTGRES_PASSWORD</code> should match the values for <code class="language-plaintext highlighter-rouge">host</code> and <code class="language-plaintext highlighter-rouge">user</code> you used in <code class="language-plaintext highlighter-rouge">homesever.yaml</code> within the database section.</p>

<p>Then create a <code class="language-plaintext highlighter-rouge">postgres</code> directory in your working directory</p>

<h3 id="create-your-first-user">Create your first user</h3>

<p>To create your first user, we’ll be using the <code class="language-plaintext highlighter-rouge">register_new_matrix_user</code>. However since we are using docker it will take a few extra steps.</p>

<p>First start your services with <code class="language-plaintext highlighter-rouge">docker-compose up -d</code>. <br />
Then run <code class="language-plaintext highlighter-rouge">docker-compose exec synapse register_new_matrix_user -c /data/homeserver.yaml http://localhost:8008</code>. <br />
This will bring up input prompts asking for a “New user localpart” (username), password, and if the user should be an admin (yes).</p>

<p>Once completed, all that’s left is to configure traefik to allow access to your homeserver</p>

<h3 id="traefik-configuration">Traefik configuration</h3>

<p>If you running Traefik from a Docker Container, make sure the ports used <code class="language-plaintext highlighter-rouge">443</code> and <code class="language-plaintext highlighter-rouge">8448</code> are exposed. As well, we will need to configure entrypoints for our routers to use. If you already have a HTTPS route on <code class="language-plaintext highlighter-rouge">443</code> you can reuse that otherwise add the following to your <code class="language-plaintext highlighter-rouge">traefik.toml</code> under <code class="language-plaintext highlighter-rouge">[entryPoints]</code></p>
<div class="language-toml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nn">[entryPoints.webSecure]</span>
		<span class="py">address</span> <span class="p">=</span> <span class="s">":443"</span>
		<span class="py">http.tls.certResolver</span> <span class="p">=</span> <span class="s">"lets-encrypt"</span>
	<span class="nn">[entryPoints.matrixSecure]</span>
		<span class="py">address</span> <span class="p">=</span> <span class="s">":8448"</span>
		<span class="py">http.tls.certResolver</span> <span class="p">=</span> <span class="s">"lets-encrypt"</span>
</code></pre></div></div>

<p>Make sure to stop and restart your Traefik instance for these changes to take effect.</p>

<p>Next, update your <code class="language-plaintext highlighter-rouge">docker-compose.yml</code> to the following:</p>
<div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">version</span><span class="pi">:</span> <span class="s2">"</span><span class="s">3.7"</span>

<span class="na">services</span><span class="pi">:</span>
  <span class="na">synapse</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s2">"</span><span class="s">matrixdotorg/synapse:latest"</span>
    <span class="na">container_name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">yournamingscheme-synapse"</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="na">SYNAPSE_SERVER_NAME</span><span class="pi">:</span> <span class="s2">"</span><span class="s">example.org"</span>
      <span class="na">SYNAPSE_REPORT_STATS</span><span class="pi">:</span> <span class="s2">"</span><span class="s">yes"</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">type</span><span class="pi">:</span> <span class="s2">"</span><span class="s">bind"</span>
        <span class="na">source</span><span class="pi">:</span> <span class="s2">"</span><span class="s">${PWD}/synapse"</span>
        <span class="na">target</span><span class="pi">:</span> <span class="s2">"</span><span class="s">/data"</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s2">"</span><span class="s">unless-stopped"</span>
    <span class="na">ulimits</span><span class="pi">:</span>
      <span class="na">nofile</span><span class="pi">:</span>
        <span class="na">soft</span><span class="pi">:</span> <span class="m">131072</span>
        <span class="na">hard</span><span class="pi">:</span> <span class="m">131072</span>
    <span class="na">depends_on</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">postgres"</span>
    <span class="na">labels</span><span class="pi">:</span>
<span class="err">		</span>  <span class="pi">-</span> <span class="s2">"</span><span class="s">traefik.http.services.synapse.loadbalancer.server.port=8008"</span>
<span class="err">		</span>  <span class="pi">-</span> <span class="s2">"</span><span class="s">traefik.http.routers.synapseServer.rule=Host(`example.org`)"</span>
<span class="err">			</span><span class="pi">-</span> <span class="s2">"</span><span class="s">traefik.http.routers.synapseServer.entrypoints=matrixSecure"</span>
<span class="err">			</span><span class="pi">-</span> <span class="s2">"</span><span class="s">traefik.http.routers.synapseServer.service=synapse"</span>
<span class="err">		</span>  <span class="pi">-</span> <span class="s2">"</span><span class="s">traefik.http.routers.synapseClient.rule=Host(`example.org`)"</span>
<span class="err">			</span><span class="pi">-</span> <span class="s2">"</span><span class="s">traefik.http.routers.synapseClient.entrypoints=webSecure"</span>
<span class="err">			</span><span class="pi">-</span> <span class="s2">"</span><span class="s">traefik.http.routers.synapseClient.service=synapse"</span>
  <span class="na">postgres</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s2">"</span><span class="s">postgres:14"</span>
    <span class="na">container_name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">yournamingscheme-postgres"</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="na">POSTGRES_USER</span><span class="pi">:</span> <span class="s2">"</span><span class="s">synapse"</span>
      <span class="na">POSTGRES_PASSWORD</span><span class="pi">:</span> <span class="s2">"</span><span class="s">useThePasswordYouPutInHomeserverYAML"</span>
      <span class="na">POSTGRES_INITDB_ARGS</span><span class="pi">:</span> <span class="s2">"</span><span class="s">--encoding=UTF8</span><span class="nv"> </span><span class="s">--locale=C"</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">type</span><span class="pi">:</span> <span class="s2">"</span><span class="s">bind"</span>
        <span class="na">source</span><span class="pi">:</span> <span class="s2">"</span><span class="s">${PWD}/postgres"</span>
        <span class="na">target</span><span class="pi">:</span> <span class="s2">"</span><span class="s">/var/lib/postgresql/data"</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s2">"</span><span class="s">unless-stopped"</span>
    <span class="na">labels</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">traefik.enable=false"</span>
</code></pre></div></div>

<p>Make sure to stop and restart your Traefik instance for these changes to take effect.</p>

<p>If you need Synapse to share the webSecure port on the host, make sure to read up on Delegation as mentioned in the Domain section.</p>

<p>Once the services are back up, check the Traefik dashboard to see if they are configured. You can also use the <a href="https://federationtester.matrix.org/">Federation Tester</a> to see if your Synapse server is accessible to other homeservers.</p>

<p>All that’s left is to get a Matrix client, point it at your homeserver, and log in!</p>

<h2 id="conclusion">Conclusion</h2>

<p>Congrats, assuming things all worked correctly, you have a working Synapse server!</p>

<p>Ways to go from here include: setting up a TURN server, further configuration of the user authenication, and reading the documentation.</p>

<p>Hopefully this has helped!</p>

<h2 id="further-reading">Further Reading</h2>
<ul>
  <li><a href="https://matrix-org.github.io/synapse/latest/welcome_and_overview.html">Synapse Documentation</a></li>
  <li><a href="https://spec.matrix.org/v1.1/">Matrix Specification</a></li>
</ul>
:ET