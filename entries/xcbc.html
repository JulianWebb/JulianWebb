----
title: Building xCBC
subtitle: a Discord to CBC bridge
creation-date: 2022-07-01
category: programming
tags: cbc, discord, nodejs, docker, traefik
----
<section>
	<p>For a while now, when linking to a CBC post on Discord, instead of generating a link preview using the Open Graph or Twitter meta tags, the link remains an undescriptive string that may hestiate to click on do to concerns around the trustworthiness and value of it.</p>
	<p>This, of course, leads to issues when you are in a community that likes to share news sources, if every other source has the preview, then CBC will be last choice to share.</p>
</section>
{% include tableOfContents.html %}
<section>
	<h3>The Problem</h3>
	<p>On July 7th, 2021, the last known link preview generated by Discord from the CBC website appeared, after that any attempts to post a link to the website directly met with a roadblock.</p>
	{%include figure.html type="image" location="/media/xcbc/link-preview-fail.png" caption="Ignore the timestamp, I totally have a sleep schedule." %}
	<p>Since the issue was self-concealing, I didn't really notice it until early 2022. In May I decided to do some testing to see if the problem was on Discord's end or CBC's end. Deciding to make a copy of an article's relevant meta tags and using them on an alternative domain.</p>
	{%include figure.html type="image" location="/media/xcbc/link-preview-success.png" caption="" %}
	<p>That worked fine, so the issue wasn't that the tags were incorrect, Discord would render it just fine, which was really annoying becuase if that was the problem the solution would be <i>really easy</i>.</p>
	<p>So unfortunately, it seemed something was just failing somewhere in the engima of a process Discord uses to generate previews, or maybe, it was intentional? <i>Dun dun dun...</i></p>
	<aside><p>Note: appropo of nothing, but anyone here know <a href="https://en.wikipedia.org/wiki/Hanlon%27s_razor" class="off">Hanlon's Razor</a>.</p></aside>
	<p>With this in mind, I tried some of the other CBC domains, I found that <code>cbc.ca</code>, <code>www.cbc.ca</code>, <code>gem.cbc.ca</code>, andd <code>cbc.radio-canada.ca</code> all failed to have a link preview but <code>ici.radio-canada.ca</code> succeed.</p>
	<p>Unable to think of anything more to test, I emailed my findings to CBC, after which we commiserated over the unknown solution and the probablity that the issue was on Discord's end.</p>
	<h4>The Lightbulb Moment</h4>
	<p>So a month later, while tinkering with some projects, an idea popped in my head. What if Discord wasn't the root of all evil?</p>
	<p>Wanting to test a theory, I used Node.js and Ngrok to get Discord's User-Agent: <code>Mozilla/5.0 (compatible; Discordbot/2.0; +https://discordapp.com)</code>, then I used it when visiting <code>cbc.ca</code> and well...</p>
	{% include figure.html type="image" location="/media/xcbc/access-denied.png" caption="" %}
	<p>It seems the issue wasn't on Discord's side after all! On both <code>cbc.ca</code> and <code>www.cbc.ca</code>, we get this response. This doesn't explain the issues on <code>gem.cbc.ca</code> or <code>cbc.radio-canada.ca</code> but it turns out those both are more easily explainable: invalid meta tags!</p>
	<aside><p>I wonder why it Twitter made it through the whitelist but not Discord?</p></aside>
	<p>Gem seems to just be missing the required tags entirely while Radio Canada seems to initial load the page with empty meta tags to be filled as the page further loads, which just doesn't work when services are scraping the basic page for the tags.</p>
	<p>Armed with slightly more useful knowledge than before, I sent off further information on June 12th explaining what I found to CBC, in hopes they'd solve it.</p>
	<p>As of July 1st, I have yet to hear back.</p>
</section>
<section>
	<h3>The Solution</h3>
	<p>So now, what can be done about the issue? I don't know if my email to the CBC got thrown in the void or just ignored. A real solution would come from them but who knows when or if that will happen?</p>
	<p>But that's quitter talk, I know the pros and the cons of gramming, I can take a shot at some sort of solution.</p>
	<p>So I present: xCBC!</p>
</section>
<section>
	<h3>The Plan</h3>
	<p>I am far from the first person to create a service meant to enhance another site, nor am I the first to think of extending a domain for ease of use of the service. In this case the idea is to have users prepend a character (<code>x</code>) to the regular CBC domain when posting a link to an article on Discord, at which point Discord will ask xCBC for it's meta tags that it will pull either from cache or from CBC using a whitelisted User Agent.</p>
	<p>Then, if a user clicks through the link, xCBC will redirect the user to CBC article for proper viewing. Simple!</p>
	{% include figure.html type="image" location="/media/xcbc/the-plan.png" caption="I'm sure this clears things up. /s" %}
	<h4>The Domain (and Project Name)</h4>
	<p>The first thing to do in such a project, is of course name it. I needed it to be [something]CBC since the branding of it needs to match the domain and the domain has to be a simple addition to <code>cbc.ca</code>.</p>
	<p>I decided to go with xCBC because it satisfied the conditions, was close to the Paste shortcut (on desktop), and most importantly the domain was available for registeration.</p>
	<aside><p>Get $6.46 off your first purchase with my <a href="https://www.name.com/referral/302312">Name.com referral</a>.</p></aside>
	<h4>The Application</h4>

</section>
